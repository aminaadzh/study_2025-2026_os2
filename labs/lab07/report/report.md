---
## Front matter
title: "Отчёт по лабораторной работе №7"
subtitle: "Управление журналами событий в системе"
author: "Амина Аджигалиева"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки работы с журналами мониторинга различных событий в системе.

# Ход выполнения работы

## Анализ системных журналов

Сначала я просмотрела логи сбоев процессов, связанных с **VBoxClient**, и сообщения о неудачных попытках получения привилегий root.  
На скриншоте видно, что при выполнении команды `su` вход был отклонён, а также зафиксированы ошибки в работе клиента VirtualBox.

![Сообщения о сбоях VBoxClient и неудачной попытке входа под root](Screenshot_1.png){ #fig:001 width=80% }

Далее я проанализировала системный журнал, где видно серию сообщений «hello» от пользователя **aradzhlgalieva**, а также повторяющиеся ошибки VBoxClient, сопровождающиеся завершением процессов с генерацией дампа памяти.  

![Системные сообщения и повторные ошибки VBoxClient](Screenshot_2.png){ #fig:002 width=80% }

Затем я обратилась к журналу **/var/log/secure**, чтобы отследить авторизации пользователей.  
В выводе отчётливо видно открытие сессий для пользователей `gdm`, `aradzhlgalieva` и `root`. Также зафиксированы ошибки проверки паролей и события, связанные с PAM (Pluggable Authentication Modules).  

![Просмотр журнала /var/log/secure](Screenshot_3.png){ #fig:003 width=80% }

## Настройка регистрации сообщений через rsyslog

Сначала я установила веб-сервер Apache и запустила его службу. Также я настроила автоматический запуск `httpd` при старте системы.  

![Установка и запуск Apache](Screenshot_4.png){ #fig:004 width=80% }

Затем я просмотрела журнал ошибок веб-службы, чтобы убедиться в корректности её работы.  
На скриншоте видно сообщения о запуске Apache и успешной конфигурации.  

![Просмотр error_log веб-сервера](Screenshot_5.png){ #fig:005 width=80% }

После этого я изменила конфигурацию веб-сервера, добавив в файл `/etc/httpd/conf/httpd.conf` строку:  
`ErrorLog syslog:local1`.  
Эта настройка позволяет перенаправлять сообщения об ошибках Apache в системный журнал.  

![Редактирование httpd.conf](Screenshot_6.png){ #fig:006 width=80% }

В каталоге `/etc/rsyslog.d` я создала новый файл конфигурации и добавила правило, которое направляет все сообщения объекта `local1` в файл `/var/log/httpd-error.log`.  

![Создание правила для регистрации ошибок Apache](Screenshot_7.png){ #fig:007 width=80% }

Затем я создала отдельный файл `debug.conf` для регистрации отладочных сообщений и указала в нём правило:  
`*.debug /var/log/messages-debug`.  

![Создание файла debug.conf](Screenshot_8.png){ #fig:008 width=80% }

После перезапуска служб `rsyslog` и `httpd` я проверила работу конфигурации. Для этого выполнила команду `logger -p daemon.debug "Daemon Debug Message"`.  
На скриншоте видно, что отладочные сообщения корректно записываются в файл `/var/log/messages-debug`, а ошибки VBoxClient продолжают фиксироваться.  

![Проверка работы отладочного логирования](Screenshot_9.png){ #fig:009 width=80% }

## Использование journalctl

Сначала я просмотрела журнал системы, чтобы получить список событий, начиная с последней загрузки.  
Команда `journalctl` показала записи ядра и системных служб, включая параметры запуска и информацию о виртуальной машине.  

![Просмотр системного журнала](Screenshot_10.png){ #fig:010 width=80% }

Затем я проанализировала ошибки, связанные с библиотеками и аварийным завершением процессов.  
Скриншоты фиксируют трассировки стека (stack trace), полученные при падении процессов.  

![Сообщения об ошибках и дампы процессов](Screenshot_11.png){ #fig:011 width=80% }  
![Повторные ошибки с трассировкой стека](Screenshot_12.png){ #fig:012 width=80% }

Для фильтрации событий я использовала встроенные параметры. При вводе команды `journalctl` и двойном нажатии Tab был отображён список доступных фильтров.  

![Отображение доступных фильтров journalctl](Screenshot_13.png){ #fig:013 width=80% }

Затем я просмотрела только те события, которые связаны с пользователем root (`UID=0`).  
В журнале отображаются действия системных служб и процессы, запускаемые от имени суперпользователя.  

![Просмотр событий для UID=0](Screenshot_14.png){ #fig:014 width=80% }

Для анализа последних записей я вывела последние 20 строк журнала с помощью команды `journalctl -n 20`.  
В сообщениях видны ошибки клиента VirtualBox и созданные дампы процессов.  

![Вывод последних строк журнала](Screenshot_15.png){ #fig:015 width=80% }

Далее я просмотрела только сообщения уровня ошибок с помощью команды `journalctl -p err`.  
В выводе содержатся ошибки графического драйвера `vmwgfx`, предупреждения ядра и сбои процессов VBoxClient.  

![Фильтрация сообщений по приоритету ошибок](Screenshot_16.png){ #fig:016 width=80% }

Используя параметр `--since yesterday`, я просмотрела все события, начиная со вчерашнего дня.  
Журнал снова показал последовательность загрузки системы и параметры ядра.  

![События со вчерашнего дня](Screenshot_17.png){ #fig:017 width=80% }

Затем я объединила фильтры и вывела только ошибки, зафиксированные со вчерашнего дня: `journalctl --since yesterday -p err`.  
Результат включает сообщения о проблемах с драйвером `vmwgfx`, PAM-авторизацией и сбоями VBoxClient.  

![Ошибки со вчерашнего дня](Screenshot_18.png){ #fig:018 width=80% }

Для получения более подробных сведений я использовала режим `journalctl -o verbose`.  
На скриншоте видно, что каждая запись сопровождается расширенными атрибутами: временем, хостом, идентификатором процесса и приоритетом.  

![Подробный вывод журнала](Screenshot_19.png){ #fig:019 width=80% }

Я использовала команду `journalctl _SYSTEMD_UNIT=sshd.service`, чтобы просмотреть сообщения, относящиеся к службе `sshd`.  
В выводе отразились предупреждение об unset-переменной окружения, а также информация о том, что сервер слушает порт 22.  

![Просмотр журнала sshd](Screenshot_20.png){ #fig:020 width=80% }

## Настройка постоянного журнала journald

По умолчанию система хранит журнал journald во временном каталоге `/run/log/journal`, и после перезагрузки записи теряются.  
Чтобы сделать журнал постоянным, я создала каталог `/var/log/journal`, назначила владельца и права доступа, а затем отправила сигнал `USR1` процессу `systemd-journald`.  

![Создание постоянного журнала journald](Screenshot_21.png){ #fig:021 width=80% }

После этого я выполнила команду `journalctl -b`, чтобы убедиться, что журнал сохраняет записи с момента последней загрузки системы.  
В выводе отразились стандартные сообщения ядра и параметры запуска.  

# Контрольные вопросы

1. **Какой файл используется для настройки rsyslogd?**  
   Основной файл конфигурации — `/etc/rsyslog.conf`. Дополнительные правила могут храниться в каталоге `/etc/rsyslog.d/`.

2. **В каком файле журнала rsyslogd содержатся сообщения, связанные с аутентификацией?**  
   Сообщения об аутентификации обычно записываются в файл `/var/log/secure`.

3. **Если вы ничего не настроите, то сколько времени потребуется для ротации файлов журналов?**  
   По умолчанию ротация журналов выполняется еженедельно (настраивается через `logrotate`).

4. **Какую строку следует добавить в конфигурацию для записи всех сообщений с приоритетом info в файл /var/log/messages.info?**  
   В конфигурацию нужно добавить строку:  
   `*.info   /var/log/messages.info`

5. **Какая команда позволяет вам видеть сообщения журнала в режиме реального времени?**  
   Для этого используется команда:  
   `journalctl -f`

6. **Какая команда позволяет вам видеть все сообщения журнала, которые были написаны для PID 1 между 9:00 и 15:00?**  
   Используется команда:  
   `journalctl _PID=1 --since "09:00" --until "15:00"`

7. **Какая команда позволяет вам видеть сообщения journald после последней перезагрузки системы?**  
   Для этого используется команда:  
   `journalctl -b`

8. **Какая процедура позволяет сделать журнал journald постоянным?**  
   Нужно создать каталог `/var/log/journal`, назначить владельца и права:  
   ```bash
   mkdir -p /var/log/journal  
   chown root:systemd-journal /var/log/journal  
   chmod 2755 /var/log/journal  
   killall -USR1 systemd-journald
   ```

# Заключение

В ходе выполнения лабораторной работы я изучила принципы работы системных журналов Linux и научилась настраивать их хранение и просмотр.  
Я освоила использование команд `journalctl` и различных параметров фильтрации, научилась отслеживать ошибки и события в режиме реального времени, а также работать с приоритетами сообщений.  
Кроме того, я настроила службу `rsyslogd` для перенаправления логов веб-сервера Apache и добавила правила для записи отладочной информации в отдельный файл.  
Я также сделала журнал journald постоянным, чтобы записи сохранялись после перезагрузки системы.  

Все выполненные действия позволили закрепить знания о механизмах логирования в Linux, а также получить практические навыки администрирования, которые необходимы для обеспечения контроля и диагностики работы системы.
